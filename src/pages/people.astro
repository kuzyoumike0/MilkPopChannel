---
import BaseLayout from "../layouts/BaseLayout.astro";

const base = import.meta.env.BASE_URL;

const chapters = [
  { no: "Chapter 01", name: "言葉を編む人", hint: "静かな余白 / 低い温度", href: "/people#p01" },
  { no: "Chapter 02", name: "影を選ぶ人", hint: "赤い余韻 / 近づくほど遠い", href: "/people#p02" },
  { no: "Chapter 03", name: "眠りの外側にいる人", hint: "淡い青 / 祈りのような声", href: "/people#p03" },
  { no: "Chapter 04", name: "順番を壊す人", hint: "色のノイズ / 逸れたリズム", href: "/people#p04" },
  { no: "Chapter 05", name: "静かに支える人", hint: "乾いた金 / きっちりした線", href: "/people#p05" },
  { no: "Chapter 06", name: "終わりを知る人", hint: "甘い影 / 近づくほど冷える", href: "/people#p06" },
];
---

<BaseLayout title="物語を読む場所" description="本を読むカフェのような雰囲気のトップページ。">
  <!-- ✅ クリック時ページめくり疑似（CSSのみで表示） -->
  <div class="flipOnClick" aria-hidden="true"></div>

  <!-- 右下：ページ番号＋Chapter表示 -->
  <div class="pageHUD" aria-hidden="true">
    <div class="pageHUDInner">
      <span class="pageLabel">Page</span>
      <span id="pageNow" class="pageNow">01</span>
      <span class="pageSlash">/</span>
      <span id="pageTotal" class="pageTotal">03</span>
      <span class="pageDot">•</span>
      <span id="pageChap" class="pageChap">Cover</span>
    </div>
  </div>

  <section class="cover" data-page="01" data-chapter="Cover">
    <div class="coverInner">
      <p class="overline">MilkPop Channel — Reading Café Edition</p>
      <h1 class="coverTitle">物語を読む場所</h1>
      <p class="lead">
        静かな灯りと、紙の温度。<br />
        ここで出会うのは、物語を生きる者たち。
      </p>

      <div class="actions">
        <a class="bookmark" href={`${base}people#p01`}>
          <span class="bookmarkText">Open the book</span>
          <span class="bookmarkSub">— People</span>
        </a>
        <a class="ghost" href="#toc">Table of contents</a>
      </div>

      <div class="turnPage">
        <span class="turnText">Turn the page</span>
        <span class="turnArrow">↓</span>
      </div>
    </div>
  </section>

  <section id="toc" class="toc" data-page="02" data-chapter="Contents">
    <div class="wrap">
      <h2 class="secTitle">目次</h2>

      <div class="tocGrid">
        {chapters.slice(0, 3).map((c) => (
          <a class="tocCard flipLink" href={c.href}>
            <div class="tocNo">{c.no}</div>
            <div class="tocName">{c.name}</div>
            <div class="tocHint">{c.hint}</div>
          </a>
        ))}
      </div>

      <div class="paperLine"></div>

      <div class="tocGrid">
        {chapters.slice(3, 6).map((c) => (
          <a class="tocCard flipLink" href={c.href}>
            <div class="tocNo">{c.no}</div>
            <div class="tocName">{c.name}</div>
            <div class="tocHint">{c.hint}</div>
          </a>
        ))}
      </div>

      <div class="tocFooter">
        <p class="tocCopy">
          ページを閉じても、物語は続いていく。<br />
          続きをめくるなら、しおりの場所へ。
        </p>

        <a class="bookmark small flipLink" href={`${base}people#p01`}>
          <span class="bookmarkText">Go to People</span>
          <span class="bookmarkSub">— Chapters</span>
        </a>
      </div>
    </div>
  </section>

  <section class="afterword" data-page="03" data-chapter="Afterword">
    <div class="wrap narrow">
      <h2 class="secTitle">あとがき</h2>

      <p class="para">
        ここは、読む場所。<br />
        同時に、誰かが生きている場所。
      </p>
      <p class="para">
        正しさよりも、余韻。<br />
        派手さよりも、静かな熱。
      </p>

      <div class="paperLine"></div>

      <div class="endRow">
        <a class="ghost" href="#toc">Back to contents</a>
        <a class="bookmark small flipLink" href={`${base}people#p01`}>
          <span class="bookmarkText">Open the next page</span>
          <span class="bookmarkSub">— People</span>
        </a>
      </div>
    </div>
  </section>

  <script is:inline>
    (() => {
      const sections = Array.from(document.querySelectorAll("section[data-page]"));
      const nowEl = document.getElementById("pageNow");
      const totalEl = document.getElementById("pageTotal");
      const chapEl = document.getElementById("pageChap");
      if (!sections.length || !nowEl || !totalEl || !chapEl) return;

      totalEl.textContent = String(sections.length).padStart(2, "0");

      const setNow = (idx) => {
        nowEl.textContent = String(idx + 1).padStart(2, "0");
        chapEl.textContent = sections[idx].dataset.chapter || "";
      };

      const update = () => {
        const mid = window.innerHeight * 0.5;
        let bestIdx = 0;
        let bestDist = Infinity;
        for (let i = 0; i < sections.length; i++) {
          const r = sections[i].getBoundingClientRect();
          const center = r.top + r.height * 0.5;
          const dist = Math.abs(center - mid);
          if (dist < bestDist) { bestDist = dist; bestIdx = i; }
        }
        setNow(bestIdx);
      };

      let raf = 0;
      const onScroll = () => {
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(update);
      };

      window.addEventListener("scroll", onScroll, { passive: true });
      window.addEventListener("resize", onScroll, { passive: true });
      update();
    })();
  </script>

  <style>
    :global(body){ background:#070709; color:#e9e9ef; }
    :global(.pastel-bg){ display:none; }
    :global(main){ padding: 0 0 40px; }

    /* ✅ クリック時：ページめくり疑似オーバーレイ（CSSのみ）
       flipLink を押している間だけ表示される
    */
    .flipOnClick{
      position: fixed;
      inset: 0;
      z-index: 2000;
      pointer-events: none;
      opacity: 0;
      transform: translateX(10px);
      background:
        linear-gradient(90deg,
          rgba(0,0,0,.65) 0%,
          rgba(0,0,0,.00) 22%,
          rgba(0,0,0,.00) 78%,
          rgba(0,0,0,.65) 100%),
        radial-gradient(1200px 520px at 50% 20%, rgba(243,208,138,.12), transparent 60%),
        repeating-linear-gradient(0deg,
          rgba(255,255,255,.016) 0px,
          rgba(255,255,255,.016) 1px,
          rgba(255,255,255,.00) 10px,
          rgba(255,255,255,.00) 18px);
      transition: opacity .12s ease, transform .12s ease;
    }
    :global(a.flipLink:active) ~ .flipOnClick{
      opacity: 1;
      transform: translateX(0);
    }

    /* NOTE: 上の sibling セレクタが効かない環境向けに、
       flipOnClick を body 直下に置く必要があるが、
       Astro構造上は main 内でOK。
       ただし :active ~ は “同一親” でないと効かないため、
       ここでは下の方法で確実化：
    */

    /* ✅ 確実化：:has() を使う（対応ブラウザはほぼ現行）
       flipLink が active の間、flipOnClick を出す
    */
    :global(body:has(a.flipLink:active)) .flipOnClick{
      opacity: 1;
      transform: translateX(0);
    }

    @media (prefers-reduced-motion: reduce){
      .flipOnClick{ transition:none; opacity:0; }
    }

    .wrap{
      width: min(1200px, calc(100% - 40px));
      margin: 0 auto;
      padding: 46px 0 64px;
    }
    .wrap.narrow{ width: min(860px, calc(100% - 40px)); }
    .secTitle{
      margin: 0 0 18px;
      text-align:center;
      font-weight: 900;
      letter-spacing:.18em;
      font-size: 18px;
    }
    .paperLine{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(243,208,138,.25), transparent);
      margin: 22px 0;
    }

    .pageHUD{
      position: fixed;
      right: 14px;
      bottom: 14px;
      z-index: 1200;
      pointer-events: none;
      opacity: .85;
    }
    .pageHUDInner{
      display:flex;
      align-items: baseline;
      gap: 8px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(6px);
    }
    .pageLabel{
      font-size: 10px;
      letter-spacing: .18em;
      color: rgba(233,233,239,.55);
    }
    .pageNow, .pageTotal{
      font-size: 12px;
      letter-spacing: .12em;
      font-weight: 900;
      color: rgba(243,208,138,.95);
    }
    .pageSlash{ color: rgba(233,233,239,.45); font-size: 11px; }
    .pageDot{ color: rgba(233,233,239,.35); }
    .pageChap{
      font-size: 10px;
      letter-spacing: .18em;
      color: rgba(233,233,239,.62);
      text-transform: uppercase;
      white-space: nowrap;
    }

    .cover{
      min-height: 90vh;
      display:flex;
      align-items:center;
      border-bottom: 1px solid rgba(255,255,255,.12);
      position: relative;
      overflow: hidden;
      background:
        radial-gradient(1200px 600px at 50% 18%, rgba(243,208,138,.10), transparent 60%),
        radial-gradient(900px 500px at 10% 82%, rgba(255,255,255,.06), transparent 65%),
        linear-gradient(180deg, rgba(7,7,9,1), rgba(7,7,9,.98));
    }
    .cover::before{
      content:"";
      position:absolute;
      inset:-20px;
      pointer-events:none;
      background:
        linear-gradient(90deg,
          transparent 0%,
          rgba(0,0,0,.00) 46%,
          rgba(0,0,0,.25) 50%,
          rgba(0,0,0,.00) 54%,
          transparent 100%),
        linear-gradient(90deg,
          rgba(0,0,0,.55) 0%,
          rgba(0,0,0,.00) 18%,
          rgba(0,0,0,.00) 82%,
          rgba(0,0,0,.55) 100%),
        repeating-linear-gradient(0deg,
          rgba(255,255,255,.015) 0px,
          rgba(255,255,255,.015) 1px,
          rgba(255,255,255,.00) 10px,
          rgba(255,255,255,.00) 18px);
      opacity: .85;
    }
    .coverInner{
      width:min(1100px, calc(100% - 40px));
      margin:0 auto;
      padding: 56px 0 30px;
      text-align:center;
      position: relative;
      z-index: 1;
    }
    .overline{ margin:0 0 12px; font-size:11px; letter-spacing:.18em; color: rgba(233,233,239,.60); }
    .coverTitle{ margin:0; font-weight: 900; letter-spacing:.18em; font-size: clamp(26px, 4vw, 46px); }
    .lead{ margin: 14px auto 0; max-width: 680px; color: rgba(233,233,239,.74); font-size: 13px; letter-spacing: .10em; line-height: 1.9; }

    .actions{ margin-top: 26px; display:flex; gap: 12px; justify-content:center; flex-wrap:wrap; align-items:center; }

    .bookmark{
      position: relative;
      display: inline-flex;
      flex-direction: column;
      gap: 2px;
      align-items: center;
      justify-content:center;

      padding: 12px 16px 18px;
      min-width: 160px;

      border: 1px solid rgba(243,208,138,.55);
      background: rgba(0,0,0,.22);
      color: rgba(243,208,138,.95);
      text-decoration: none;

      letter-spacing: .14em;
      font-weight: 900;

      transition: transform .18s ease, filter .18s ease;
      animation: bookmarkWobble 3.6s ease-in-out infinite;
      transform-origin: 50% 0%;
      will-change: transform;
    }
    .bookmark::after{
      content:"";
      position:absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: -1px;
      width: 0; height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-top: 14px solid rgba(7,7,9,1);
      filter: drop-shadow(0 -1px 0 rgba(243,208,138,.55));
    }
    @keyframes bookmarkWobble{
      0%, 100% { transform: rotate(-0.3deg) translateY(0px); }
      50%      { transform: rotate(0.3deg) translateY(-1px); }
    }
    @media (prefers-reduced-motion: reduce){
      .bookmark{ animation: none !important; }
      .turnArrow{ animation: none !important; }
    }

    .bookmarkText{ font-size: 12px; }
    .bookmarkSub{ font-size: 10px; color: rgba(233,233,239,.70); letter-spacing: .18em; font-weight: 800; }
    .bookmark:hover{ filter: brightness(1.08); transform: translateY(-2px); }
    .bookmark.small{ padding: 10px 14px 16px; min-width: 150px; }

    .ghost{
      padding: 10px 14px;
      font-size: 12px;
      letter-spacing: .14em;
      color: rgba(233,233,239,.72);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.02);
      text-decoration:none;
      transition: filter .18s ease;
    }
    .ghost:hover{ filter: brightness(1.08); }

    .turnPage{ margin-top: 26px; display:flex; flex-direction: column; gap: 8px; align-items:center; color: rgba(233,233,239,.55); font-size: 11px; letter-spacing:.16em; }
    .turnArrow{ display:inline-block; animation: bob 1.4s ease-in-out infinite; }
    @keyframes bob{ 0%,100%{ transform: translateY(0); opacity:.7; } 50%{ transform: translateY(6px); opacity:1; } }

    .toc{
      border-bottom: 1px solid rgba(255,255,255,.12);
      position: relative;
      overflow:hidden;
    }
    .toc::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        repeating-linear-gradient(0deg,
          rgba(255,255,255,.012) 0px,
          rgba(255,255,255,.012) 1px,
          rgba(255,255,255,.00) 10px,
          rgba(255,255,255,.00) 18px);
      opacity: .8;
    }
    .toc > .wrap{ position:relative; z-index:1; }

    .tocGrid{ display:grid; gap: 18px; grid-template-columns: 1fr; }
    @media(min-width:820px){ .tocGrid{ grid-template-columns: repeat(3, 1fr); } }
    .tocCard{
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      padding: 16px 16px 14px;
      display:block;
      text-decoration:none;
      transition: filter .18s ease, transform .18s ease;
    }
    .tocCard:hover{ filter: brightness(1.06); transform: translateY(-2px); }
    .tocNo{ font-size: 11px; letter-spacing:.14em; color: rgba(243,208,138,.9); font-weight: 900; }
    .tocName{ margin-top: 8px; font-size: 13px; letter-spacing:.10em; font-weight: 900; color: rgba(233,233,239,.92); }
    .tocHint{ margin-top: 8px; font-size: 11px; line-height: 1.7; letter-spacing:.08em; color: rgba(233,233,239,.64); }

    .tocFooter{ margin-top: 28px; text-align:center; display:flex; flex-direction: column; gap: 14px; align-items:center; }
    .tocCopy{ margin:0; font-size: 12px; letter-spacing: .10em; line-height: 1.9; color: rgba(233,233,239,.70); }

    .afterword{
      position: relative;
      overflow:hidden;
    }
    .afterword::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        linear-gradient(90deg,
          rgba(0,0,0,.35) 0%,
          rgba(0,0,0,.00) 18%,
          rgba(0,0,0,.00) 82%,
          rgba(0,0,0,.35) 100%),
        repeating-linear-gradient(0deg,
          rgba(255,255,255,.010) 0px,
          rgba(255,255,255,.010) 1px,
          rgba(255,255,255,.00) 10px,
          rgba(255,255,255,.00) 18px);
      opacity: .85;
    }
    .afterword > .wrap{ position:relative; z-index:1; }

    .para{ margin: 0 auto 12px; max-width: 620px; text-align:center; font-size: 13px; letter-spacing: .10em; line-height: 1.9; color: rgba(233,233,239,.74); }
    .endRow{ display:flex; justify-content:center; gap: 12px; flex-wrap: wrap; align-items:center; margin-top: 10px; }

    @media (max-width: 640px){ .pageHUD{ opacity: .70; } }
  </style>
</BaseLayout>
